import streamlit as st
import pandas as pd
import itertools
import random
from collections import Counter
import re
import json
import os
import datetime

# ===========================================================
# 1. ê¸°ë³¸ ì„¤ì • (ë¬´ì¡°ê±´ ë§¨ ìœ„ì— ìˆì–´ì•¼ í•¨)
# ===========================================================
st.set_page_config(page_title="ë…ì„œëª¨ì„ ìš´ì˜ ì‹œìŠ¤í…œ", page_icon="ğŸ“š", layout="wide")

DB_FILE = "meeting_db.json"

NAME_MAP = {
    "í˜œì€": "ë‹´ì´", "ë…¸ì¥¬": "ë…¸ì£¼", "ì§€ë¯¼": "ì´ì§€ë¯¼", "ì§€ë¯¼(í•œ)": "í•œì§€ë¯¼",
    "ì •ì„ì˜": "ì„ì˜", "ìœ¤ìŠ¹í˜„": "ìŠ¹í˜„", "ì •ì¼ê·¼": "ì¼ê·¼"
}

def clean_name(name):
    name = re.sub(r'\([^)]*\)', '', name).strip()
    return NAME_MAP.get(name, name)

# ì´ˆê¸° ë°ì´í„° (1íšŒ~26íšŒ)
DEFAULT_DATA = [
    {"round": 1, "date": "23.10", "groups": [["í˜œì€", "ì •ì€", "ì„êµ¬", "ì¬ì„±", "ì†Œí¬", "ê¸°ì°½", "ì±„ë‹ˆ", "ì„ì •", "ìŠ¹í˜„"]]},
    {"round": 2, "date": "23.11", "groups": [["ì±„ë‹ˆ", "ì‚¬ë‘", "ì€í•˜", "ê¸°ì°½", "ìŠ¹í˜„"]]},
    {"round": 3, "date": "23.12", "groups": [["ì„ì˜", "ê¸°ì°½", "ìŠ¹í˜„", "ì¼ê·¼", "ì •ì€", "ì±„ë‹ˆ", "ì‚¬ë‘"]]},
    {"round": 4, "date": "24.01", "groups": [["ì„ì˜", "íƒœí™˜", "ê¸°ì°½", "ì€í•˜", "ì†Œë‹´", "ìŠ¹í˜„", "ì›ë¹ˆ", "ì€ì²œ", "ì¼ê·¼", "ì„ì •", "ì •ì€", "ì±„ë‹ˆ"]]},
    {"round": 5, "date": "24.02", "groups": [["ì„ì˜", "íƒœí™˜", "ê¸°ì°½", "ë¬´ê·¼", "ì •ì€", "í˜œì€", "ì±„ë‹ˆ"]]},
    {"round": 6, "date": "24.03", "groups": [["ì„ì˜", "íƒœí™˜", "ì€í•˜", "ì„ í¬", "ì›ë¹ˆ", "ì˜ëª¨", "ìŠ¹í˜„", "ì¼ê·¼", "ì‚¬ë‘", "ë¯¸ì£¼", "ì€ì²œ"]]},
    {"round": 7, "date": "24.04", "groups": [["ì„ì˜", "íƒœí™˜", "ì˜ê±´", "ì‚¬ë‘", "ì§„ì•„", "ì •ì€"], ["ìŠ¹í˜„", "ì„ì •", "ì±„ë‹ˆ", "ë¬´ê·¼"], ["ì¼ê·¼", "ì˜ëª¨", "ì€í•˜", "í•˜ëŠ˜", "ë¬¸í˜•", "ì†Œë‹´"]]},
    {"round": 8, "date": "24.05", "groups": [["ê¸°ì°½", "íƒœí™˜", "ìˆ˜ë¹ˆ", "ì€í•˜", "ì •ì€"], ["ì±„ë‹ˆ", "ìŠ¹í˜„", "ì„ í¬", "ì‚¬ë‘", "ì„ì˜"]]},
    {"round": 9, "date": "24.06", "groups": [["ê¸°ì°½", "ì„ í¬", "ì‚¬ë‘", "ë¬¸í˜•", "ì„±ìš´", "ìˆ˜ë¯¼"], ["ì •ì€", "ì„ì˜", "ì˜ëª¨", "ìˆ˜ë¹ˆ", "ë¬´ê·¼", "ë„ì•„"], ["ì±„ë‹ˆ", "íƒœí™˜", "í˜œì€", "ì€í•˜", "ì€ì²œ"]]},
    {"round": 10, "date": "24.07", "groups": [["ê¸°ì°½", "ì•„ë¡ ", "ì„±ì€", "ì€í•˜", "ì‚¬ë‘", "ì§„ì•„"], ["ì •ì€", "ì±„ì•„", "ë¬¸í˜•", "ìˆ˜ë¹ˆ", "íƒœí™˜", "ìˆ˜ë¯¼"], ["ì±„ë‹ˆ", "ì„ì˜", "ë…¸ì£¼", "ë¬´ê·¼", "í˜œì€", "ì€ì²œ"]]},
    {"round": 11, "date": "24.08", "groups": [["ê¸°ì°½", "ì¤€ì˜¤", "ìˆ˜ë¹ˆ", "ë¯¼ì„ ", "ë™ê·¼", "ì§„ì•„", "ì„ í¬"], ["ì˜ëª¨", "ë…¸ì¥¬", "ìˆ˜
